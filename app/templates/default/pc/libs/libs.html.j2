{# 分页 - 分页html #}
{% macro pagination_html(pagination, page_size=20) -%}
  <div class="page-box">
    {{ build_pagination_html(pagination, page_size) }}
  </div>
{% endmacro %}

{# 分页 - 生成分页html #}
{% macro build_pagination_html(pagination, page_size) %}
  {% if pagination.total > 0 %}
    {% set has_prev = 1 if pagination.has_prev else 0 %}
    {% set href = pagination_href(pagination.prev_num, page_size) if pagination.has_prev else 'javascript:void(0);' %}
    {% if has_prev == 1 %}
      <a class="page-num page-first" href="{{ href }}">
        <i class="icon-xiaoyu"></i>
      </a>
    {% else %}
      <span class="page-num page-first">
        <i class="icon-xiaoyu"></i>
      </span>
    {% endif %}

    {% for page in pagination.iter_pages() %}
      {% if page %}
        {% set btn_current = 'btn-current' if page == pagination.page else '' %}
        {% set href = 'javascript:void(0);' if page == pagination.page else pagination_href(page, page_size) %}
        <a class="page-num {{ btn_current }}" href="{{ href }}">{{ page }}</a>
      {% else %}
        <span class="page-more">...</span>
      {% endif %}
    {% endfor %}

    {% set has_next = 1 if pagination.has_next else 0 %}
    {% set href = pagination_href(pagination.next_num, page_size) if pagination.has_next else 'javascript:void(0);' %}
    {% if has_next == 1 %}
      <a class="page-num page-last" href="{{ href }}">
        <i class="icon-dayu"></i>
      </a>
    {% else %}
      <span class="page-num page-last">
        <i class="icon-dayu"></i>
      </span>
    {% endif %}
  {% endif %}
{% endmacro %}

{# 分页 - 分页URL #}
{% macro pagination_href(page, page_size) %}
  {% set page_size = page_size if page_size else request.view_args.get('page_size', 20) %}
  {% set query_string = request.args.to_dict()|request_args_to_query_string(page, page_size) %}
  {{ url_for(request.endpoint) }}?{{ query_string }}
{% endmacro %}

{# 分页 - js分页html #}
{% macro pagination_html_js(pagination, params, page_size=20) -%}
  <div class="page-box">
    {{ build_pagination_html_js(pagination, params, page_size) }}
  </div>
{% endmacro %}

{# 分页 - 生成js分页html #}
{% macro build_pagination_html_js(pagination, params, page_size) %}
  {% set page_size = page_size if page_size else request.view_args.get('page_size', 20) %}
  {% if pagination.total > 0 %}
    {% set has_prev = 1 if pagination.has_prev else 0 %}
    {% if has_prev == 1 %}
      {% set query_string = params|request_args_to_query_string(pagination.prev_num, page_size) %}
      <a class="page-num page-first" href="javascript:void(0);" onclick="jump_page('{{ query_string }}')">
        <i class="icon-xiaoyu"></i>
      </a>
    {% else %}
      <span class="page-num page-first">
        <i class="icon-xiaoyu"></i>
      </span>
    {% endif %}

    {% for page in pagination.iter_pages() %}
      {% if page %}
        {% set btn_current = 'btn-current' if page == pagination.page else '' %}
        {% if page == pagination.page %}
          <a class="page-num {{ btn_current }}" href="javascript:void(0);">{{ page }}</a>
        {% else %}
          {% set query_string = params|request_args_to_query_string(page, page_size) %}
          <a class="page-num {{ btn_current }}" href="javascript:void(0);" onclick="jump_page('{{ query_string }}')">{{ page }}</a>
        {% endif %}
      {% else %}
        <span class="page-more">...</span>
      {% endif %}
    {% endfor %}

    {% set has_next = 1 if pagination.has_next else 0 %}
    {% if has_next == 1 %}
      {% set query_string = params|request_args_to_query_string(pagination.next_num, page_size) %}
      <a class="page-num page-last" href="javascript:void(0);" onclick="jump_page('{{ query_string }}')">
        <i class="icon-dayu"></i>
      </a>
    {% else %}
      <span class="page-num page-last">
        <i class="icon-dayu"></i>
      </span>
    {% endif %}
  {% endif %}
{% endmacro %}

{# 判断个人中心-左侧菜单选中项 #}
{% macro get_me_navclass(nav_cat) %}
  {% set nav_cat_dict = {
    'order':['pc.order.index', 'pc.order.detail'],
    'comment':['pc.order.comment'],
    'aftersales':['pc.aftersales.root', 'pc.aftersales.detail'],
    'profile':['pc.me.index'],
    'messages':['pc.me.messages'],
    'wallet':['pc.wallet.root'],
    'collect':['pc.me.collect'],
    'coupon':['pc.me.coupon'],
    'addresses':['pc.me.addresses'],
  }%}
  {% set endpoint_list = nav_cat_dict.get(nav_cat, []) %}
  {% set class_on = ' class="allOn" ' if request.endpoint in endpoint_list else '' %}
  {{ class_on }}
{% endmacro %}