{% extends '/default/mobile/layout/base.html.j2' %} 

{% block head %}
<title>{{_('申请售后- 一店')}}</title>
<link rel="stylesheet" href="/static/default/mobile/css/user.css"> 
{% endblock %} 

{% block body %}
<div class="user_wrap">
 <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd">
        <div class="blackGap mar-bottom">{{_('服务类型')}}</div>
        <button type="button" class="tag_btn tag_btn-on">{{_('仅退款')}}</button>
        <p class="all_desc mar-top">{{_('仅退款：未收到货(包含未签收)，或卖家协商同意前提下')}}</p>
      </div>
    </div>
  </div>
  <div class="weui-cells weui-cells_form">
    {% for goods in goods_data %}
      <div class="weui-cell">
        <div class="weui-cell__hd avatar mar-right">
          <img src="{{ goods.goods_img }}" alt="">
        </div>
        <div class="weui-cell__bd">
          <div class="all_title height25">{{ goods.goods_name }}</div>
          <div class="all_desc height25">
            <span>x {{ goods.goods_quantity }}</span>
          </div>
        </div>
      </div>
    {% endfor %}
    <div class="weui-cell">
      <div class="weui-cell__bd">
        <p class="blackGap mar-bottom">{{_('申请原因')}}</p>
        <div class="weui-cell" style="background:#f3f4f5;border-radius:5px;">
          <textarea id="content" name="content" class="review_text" rows="5" placeholder="{{_('请输入退款说明...')}}" style="background:#f3f4f5"></textarea>
        </div>
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__bd">
        <p class="blackGap">
          {{_('退款金额：')}}
          <span class="all_price">￥{{ refunds_amount }}</span>
        </p>
        <p class="all_desc mar-top">{{_('注：退款金额将返回到您原支付账户')}}</p>
      </div>
    </div>
  </div>
  <div class="weui-gallery" style="display: none">
    <span class="weui-gallery__img"></span>
    <div class="weui-gallery__opr">
      <a href="javascript:" class="weui-gallery__del">
        <i class="weui-icon-delete weui-icon_gallery-delete"></i>
      </a>
    </div>
  </div>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell uploader_wrap">
      <div class="weui-cell__bd">
        <div class="blackGap mar-bottom">{{_('上传凭证')}}</div>
        <div class="weui-uploader">
          <div class="weui-uploader__bd">
            <ul class="weui-uploader__files" id="uploaderFiles"></ul>
            <div class="weui-uploader__input-box">
              <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/*" multiple="">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="height:75px"></div>
  <div class="footer" style="display:block;height:65px">
    {{ wtf_form.csrf_token }}
    <input id="order_id" name="order_id" type="hidden" value="{{ order_id }}" />
    <a class="weui-cell weui-cell_access" href="javascript:;" style="padding:10px" onclick="submit()">
      <button type="button" class="weui-btn weui-btn_red">提交申请</button>
    </a>
  </div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
var csrftoken = $('#csrf_token').val();
$.ajaxSetup({
  headers: {'X-CSRFToken':csrftoken}
});

function submit() {
  var order_id = $("#order_id").val();
  var content = $("#content").val();

  var params = {'order_id':order_id, 'content':content, 'aftersales_type':1}
  $.post("{{ url_for('api.aftersales.apply') }}", params, function(json) {
    if (json.ret == 0) {
      window.location.href = "{{ url_for('mobile.aftersales.root') }}";
    } else {
      $.toast(json.msg, "text");
      return false;
    }
  });
}
</script>
{% endblock %}