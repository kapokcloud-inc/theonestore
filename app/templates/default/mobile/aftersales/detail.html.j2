{% extends '/default/mobile/layout/base.html.j2' %} 
{% import '/default/mobile/libs/const.html.j2' as const %}

{% block head %}
<title>{{_('售后服务详情- 一店')}}</title>
<link rel="stylesheet" href="/static/default/mobile/css/user.css">
{% endblock %}

{% block body %}
<div class="user_wrap">
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd blackGap">{{_('申请信息')}}</div>
    </div>
    <div class="weui-form-preview">
      <div class="weui-form-preview__bd">
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('申请类别')}}</label>
          <span class="weui-form-preview__value">{{ const.AFTERSALES_TYPE.get(aftersales.aftersales_type) }}</span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('申请单号')}}</label>
          <span class="weui-form-preview__value">{{ aftersales.aftersales_sn }}</span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('申请时间')}}</label>
          <span class="weui-form-preview__value">{{ aftersales.add_time|timestamp2str }}</span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('申请件数')}}</label>
          <span class="weui-form-preview__value">{{ aftersales.quantity }}件</span>
        </div>
        {% if aftersales.aftersales_type in ([1,2]) %}
          <div class="weui-form-preview__item">
            <label class="weui-form-preview__label">{{_('退款金额')}}</label>
            <span class="weui-form-preview__value">￥{{ aftersales.refunds_amount }}</span>
          </div>
        {% endif %}
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('图片')}}</label>
          <span class="weui-form-preview__value">
            {% set img_data = aftersales.img_data|json_loads %}
            {% for img in img_data %}
              <img class="applyImg" src="{{ img }}-square.middle" alt="">
            {% endfor %}
          </span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('申请原因')}}</label>
          <span class="weui-form-preview__value">{{ aftersales.content }}</span>
        </div>
      </div>
    </div>
  </div>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd">
        <a href="{{ url_for('mobile.index.root') }}" class="all_title">{{_('一店')}}</a>
      </div>
    </div>
    {% set goods_data = aftersales.goods_data|json_loads %}
    {% for goods in goods_data %}
      <div class="weui-cell  not_before">
        <div class="weui-cell__hd avatar mar-right">
          <img src="{{ goods.goods_img }}-square.small" alt="">
        </div>
        <div class="weui-cell__bd">
          <div class="all_title height25">{{ goods.goods_name }}</div>
          <div class="all_desc height25">{{ goods.goods_desc }}</div>
        </div>
        <div class="weui-cell__ft mar-left">
          <p>x {{ goods.goods_quantity }}</p>
        </div>
      </div>
    {% endfor %}
  </div>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd all_add">{{ log.add_time|timestamp2str }}</div>
      <div class="weui-cell__ft mar-left tradingW">
        <span class="trading_state">{{ status_text }}</span>
      </div>
    </div>
    <a class="weui-cell weui-cell_access" href="{{ url_for('mobile.aftersales.track',aftersales_id=aftersales.aftersales_id) }}">
      <div class="weui-cell__bd blackGap">{{ '%s，点进去可看' % log.content }}</div>
      <div class="weui-cell__ft"></div>
    </a>
  </div>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd blackGap">{{_('商品寄回信息')}}</div>
    </div>
    <div class="weui-form-preview">
      <div class="weui-form-preview__bd">
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('收货人')}}</label>
          <span class="weui-form-preview__value">大头</span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('电话')}}</label>
          <span class="weui-form-preview__value">13510515229</span>
        </div>
        <div class="weui-form-preview__item">
          <label class="weui-form-preview__label">{{_('地址')}}</label>
          <span class="weui-form-preview__value">深圳市南山区留仙大道平山一路大园工业区8栋510</span>
        </div>
      </div>
    </div>
  </div>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__bd">{{_('填写寄回商品快递单号')}}</div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd">
        <label class="weui-label blackGap">{{_('快递单号：')}}</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" type="text" placeholder="{{_('请填写快递单号')}}">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cells__tips">{{_('备注：快递面单信息需填写完整且需与您售后申请单信息一致；
        务必请将申请单号备注在快递面单上再行邮寄！ 一个服务单号邮寄一个包裹！若有问题请联系客服')}}</div>
    </div>
    
    <div class="weui-cell">
      <div class="weui-cell__bd">
        <button type="button" class="weui-btn weui-btn_red" onclick="">{{_('提交')}}</button>
      </div>
    </div>
  </div>

  <!-- 售后图片点击放大弹窗 -->
  <div class="weui-gallery" id="gallery">
    <div class="close_img" id="closeImg">
      <img src="/static/default/mobile/img/close.png" alt="">
    </div>
    <div class="">
      <img class="gallery_img" id="galleryImg" src="//static-aliyun.kapokcloud.com/comment/2018-08-16/085921855e614452b1d70fb1e272fb37.jpg" alt="">
    </div>
    <div class="weui-gallery__opr">
      <div class="prevImg" style="margin-right:30px;" id="prev">
        <img src="/static/default/mobile/img/xiaoyu.png" alt="">
      </div>
      <div class="nextImg" style="margin-left:30px;" id="next">
        <img src="/static/default/mobile/img/dayu.png" alt="">
      </div>
    </div>
  </div>
  <!-- 售后图片点击放大弹窗 end -->
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
$(document).ready(function(){
  // 点击图片放大事件
  $('.applyImg').click(function () {
    var $current = $(this);
    showImgGiant($current);
    $('#gallery').fadeIn(100);

    // 图片点击上一张按钮事件
    $('#prev').click(function () {
      $current = $current.prev();
      var img_url = $current.attr('src');
      var img_url_giant = img_url.replace('-square.middle', '-square.giant');
      $('#galleryImg').attr("src", img_url_giant);
      showImgGiant($current);
    });

    // 图片点击下一张按钮事件
    $('#next').click(function () {
      $current = $current.next();
      var img_url = $current.attr('src');
      var img_url_giant = img_url.replace('-square.middle', '-square.giant');
      $('#galleryImg').attr("src", img_url_giant);
      showImgGiant($current);
    });
  });

  // 点击关闭弹窗事件
  $('#closeImg').click(function () {
    $('#gallery').fadeOut(100);
  });
});

/**
 * 图片放大
 */
function showImgGiant($current) {
  var $prev = $current.prev();
  var $next = $current.next();
  var img_url = $current.attr('src');
  var img_url_giant = img_url.replace('-square.middle', '-square.giant');
  $('#galleryImg').attr('img_url_giant');

 // 判断上一张
  if ($prev.length <= 0) {
    $('#prev').hide();
  } else {
    $('#prev').show();
  }

  // 判断下一张
  if ($next.length <= 0) {
    $('#next').hide();
  } else {
    $('#next').show();
  }
}
</script>
{% endblock %}